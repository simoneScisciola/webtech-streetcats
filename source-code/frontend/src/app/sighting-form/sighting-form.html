<app-form-card
  title="Nuovo Avvistamento"
  subtitle="Registra un nuovo sighting nella mappa."
  [icon]="icons.binoculars">

  <form [formGroup]="sightingForm" (ngSubmit)="onSubmit()" novalidate>

    <app-form-field
      id="title"
      label="Titolo"
      placeholder="Es. Aquila reale sul monte Faito"
      [control]="title"
      [icon]="icons.tag"
      [errors]="titleErrors">
    </app-form-field>

    <!-- Textarea — gestita direttamente, non tramite form-field -->
    <div class="mb-3">
      <label for="description" class="form-label fw-semibold">Descrizione</label>
      <div class="input-group align-items-start">
        <span class="input-group-text text-muted pt-2">
          <fa-icon [icon]="icons.text"></fa-icon>
        </span>
        <textarea
          id="description"
          formControlName="description"
          class="form-control"
          [class.is-invalid]="description.invalid && description.touched"
          [class.is-valid]="description.valid && description.touched"
          rows="3"
          placeholder="Descrivi cosa hai osservato...">
        </textarea>
      </div>
      @if (description.invalid && description.touched) {
        @for (error of descriptionErrors | keyvalue; track error.key) {
          @if (description.hasError(error.key)) {
            <div class="invalid-feedback d-block">{{ error.value }}</div>
          }
        }
      }
    </div>

    <app-form-field
      id="location"
      label="Posizione"
      placeholder="Es. Monte Faito, Campania"
      [control]="location"
      [icon]="icons.marker"
      [errors]="locationErrors">
    </app-form-field>

    <app-form-field
      id="date"
      label="Data"
      type="date"
      [control]="date"
      [icon]="icons.calendar"
      [errors]="dateErrors">
    </app-form-field>

    <!-- Select — gestita direttamente -->
    <div class="mb-4">
      <label for="category" class="form-label fw-semibold">Categoria</label>
      <div class="input-group">
        <span class="input-group-text text-muted">
          <fa-icon [icon]="icons.category"></fa-icon>
        </span>
        <select
          id="category"
          formControlName="category"
          class="form-select"
          [class.is-invalid]="category.invalid && category.touched"
          [class.is-valid]="category.valid && category.touched">
          <option value="">Seleziona una categoria...</option>
          @for (cat of categories; track cat) {
            <option [value]="cat">{{ cat }}</option>
          }
        </select>
      </div>
      @if (category.invalid && category.touched) {
        <div class="invalid-feedback d-block">{{ categoryErrors.required }}</div>
      }
    </div>

    <button type="submit" class="btn btn-primary w-100">
      <fa-icon [icon]="icons.add" class="me-2"></fa-icon>
      Aggiungi Sighting
    </button>

  </form>

</app-form-card>