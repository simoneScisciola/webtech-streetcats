<app-form-card>

  <app-form-card-header
    title="New Sighting"
    subtitle="Add a new sighting in the map."
    [icon]="icons.binoculars">
  </app-form-card-header>

  <app-form-card-body>
    <form [formGroup]="sightingForm" (ngSubmit)="onSubmit()" novalidate>
      <app-form-card-field
        id="title"
        label="Title"
        placeholder="Sighting title"
        [control]="title"
        [icon]="icons.title"
        [errors]="titleErrors">
      </app-form-card-field>

      <!-- Description Textarea -->
      <app-form-card-text-markdown
        id="description2"
        label="Description"
        placeholder="(Optional) Describe your sighting..."
        [control]="description"
        [icon]="icons.description">
      </app-form-card-text-markdown>

      <!-- Photo drag and drop -->
      <app-form-card-drag-and-drop-image
        id="photo"
        label="Photo"
        [control]="photo"
        [icon]="icons.photo"
        [errors]="photoErrors">
      </app-form-card-drag-and-drop-image>

      <app-form-card-field
        id="address"
        label="Address"
        placeholder="(Optional) e.g. Vesuvio, Campania, Italy"
        [control]="address"
        [icon]="icons.address">
      </app-form-card-field>

      <!-- Geographic coordinates section -->
      <div class="border border-2 rounded p-3 mb-3" style="border-color: var(--bs-gray-300) !important;">

        <p class="fw-bolder mt-1">Geographic Coordinates</p>

        <!-- When true, the form shows a "waiting for map click" banner. -->
        @if (this.sightingsMapState.isPickingCoordinates()) {
          
          <!-- Picking coordinates banner -->
          <div class="alert alert-info d-flex align-items-center justify-content-between p-2 mb-3">
            <span class="small">
              <fa-icon [icon]="icons.pick" class="me-2"></fa-icon>Click on the map to pick a location...
            </span>
            <button
              type="button"
              class="btn btn-sm btn-outline-secondary ms-2"
              (click)="onCancelPickFromMapClick()">
              Cancel
            </button>
          </div>

        } @else {

          <!-- Pick-from-map coordinates button -->
          <button
            type="button"
            class="btn btn-sm btn-outline-secondary w-100 mb-3"
            (click)="onPickFromMapClick()">
            <fa-icon [icon]="icons.pick" class="me-2"></fa-icon>Pick from map
          </button>

        }

        <!-- Coordinate fields -->
        <app-form-card-field
          id="latitude"
          label="Latitude"
          type="number"
          placeholder="e.g. 41.89025436"
          [control]="latitude"
          [icon]="icons.latitude"
          [errors]="latitudeErrors">
        </app-form-card-field>

        <app-form-card-field
          id="longitude"
          label="Longitude"
          type="number"
          placeholder="e.g. 12.49218654"
          [control]="longitude"
          [icon]="icons.longitude"
          [errors]="longitudeErrors">
        </app-form-card-field>

      </div>

      <div class="row g-2 mt-3">
        <div class="col">
          <button
            type="button"
            class="btn btn-outline-dark w-100 fw-medium"
            (click)="onCancelClick()">
            Cancel
          </button>
        </div>
        <div class="col">
          <button
            type="submit"
            class="btn btn-primary w-100 fw-medium">
            <fa-icon [icon]="icons.add" class="me-2"></fa-icon>Add
          </button>
        </div>
      </div>
    </form>
  </app-form-card-body>

</app-form-card>