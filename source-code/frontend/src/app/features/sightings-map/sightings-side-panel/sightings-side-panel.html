<app-side-panel [width]="width">

  <app-side-panel-header
    title="Sightings"
    [icon]="icons.title"
    (closeButtonClick)="onClosePanel()">
  </app-side-panel-header>

  <app-side-panel-body>
    @if (isAddingNewSighting()) {

      <!-- Form visible when adding a new sighting -->
      <app-add-sighting-form
        (formSubmitted)="onAddSightingSubmit($event)"
        (cancelButtonClick)="onCancelAddSighting()">
      </app-add-sighting-form>

    } @else {

      <!-- Refresh bar -->
      <div class="d-flex align-items-center justify-content-between px-3 pb-2 mb-3 border-bottom">
        <span class="text-muted small">
          @if (this.sighting.lastUpdatedFormatted()) {
            Last update at {{ this.sighting.lastUpdatedFormatted() }}
          } @else {
            Loading...
          }
        </span>
        <button
          class="btn btn-sm btn-outline-dark"
          [disabled]="this.sighting.isLoading()"
          (click)="onRefresh()"
          style="--bs-btn-padding-y: .15rem; --bs-btn-padding-x: .30rem;">
          <fa-icon 
            [icon]="this.sighting.isLoading() ? icons.loading : icons.refresh"
            [animation]="this.sighting.isLoading() ? 'spin' : undefined"
            [size]="'sm'">
          </fa-icon>
        </button>
      </div>

      <!-- Sightings list -->
      @for (sighting of this.sighting.sightings(); track sighting.id) {
        <app-sighting-card
          [title]="sighting.title"
          [lastSeen]="sighting.createdAt"
          [description]="sighting.description ?? ''"
          [accentColor]="'#E5772D'">
        </app-sighting-card>
      } @empty {
        @if (!this.sighting.isLoading()) {
          <p class="text-muted text-center p-4">No sightings found.</p>
        }
      }

    }
  </app-side-panel-body>

  <!-- Footer is only shown when not adding a new sighting -->
  @if (!isAddingNewSighting()) {
    <app-side-panel-footer>
      <button class="btn btn-primary w-100 fw-medium" (click)="onAddSightingClick()">
        <fa-icon [icon]="icons.addSighting" class="me-2"></fa-icon>Add Sighting
      </button>
    </app-side-panel-footer>
  }

</app-side-panel>