// Reference:
// - https://code.visualstudio.com/docs/debugtest/debugging-configuration
{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": [

        // Backend configuration
        {
            "name": "Debug: Express backend",
            "type": "node-terminal",
            "request": "launch",
            "cwd": "${workspaceFolder}/source-code/backend",
            "command": "npm run dev",
            "skipFiles": [
                "<node_internals>/**", // Node.js internal core modules
                "${workspaceFolder}/source-code/backend/node_modules/**", // Ignore all dependencies (optional)
            ],
            //"outFiles": [
            //    "${workspaceFolder}/source-code/backend/dist/**/*.js"
            // ]
        },
        {
            // Attach to process using: tsx --inspect-brk ./src/index.ts
            "name": "Attach to process: Express backend",
            "type": "node",
            "request": "attach",
            "port": 9229,
            "skipFiles": [
                "<node_internals>/**", // Node.js internal core modules
                "${workspaceFolder}/node_modules/**", // Ignore all dependencies (optional)
            ]
        },

        // Frontend configurations
        {
            "name": "Debug: Angular frontend",                          // Debugging configuration name
            "type": "chrome",                                           // Sets the type of configuration
            "request": "launch",                                        // Tells that this configuration will launch a new instance of the program
            "cwd": "${workspaceFolder}/source-code/frontend",           // Sets the working directory of the application
            "webRoot": "${workspaceFolder}/source-code/frontend",       // Specifies the workspace absolute path to the webserver root
            "preLaunchTask": "start: npm dev:docker",                   // Launch a task before the start of the debug session. It must be equal to the "label" of the task we want to launch in tasks.json

            "postDebugTask": "stop: npm dev",                           // Task to run after debug session ends. It must be equal to the "label" of the task we want to launch in tasks.json
            "url": "http://localhost:${input:FRONTEND_PORT}/"           // Will search for a tab with this exact url and attach to it, if found. Input variable defined later.
        },
        {
            "name": "Test: Angular frontend",                           // Debugging configuration name
            "type": "chrome",                                           // Sets the type of configuration
            "request": "launch",                                        // Tells that this configuration will launch a new instance of the program
            "cwd": "${workspaceFolder}/source-code/frontend",           // Sets the working directory of the application
            "webRoot": "${workspaceFolder}/source-code/frontend",       // Specifies the workspace absolute path to the webserver root
            "preLaunchTask": "start: npm test",                         // Launch a task before the start of the debug session. It must be equal to the "label" of the task we want to launch in tasks.json  
            "postDebugTask": "stop: npm test",                          // Task to run after debug session ends. It must be equal to the "label" of the task we want to launch in tasks.json
            "url": "http://localhost:${input:KARMA_PORT}/debug.html"    // Will search for a tab with this exact url and attach to it, if found. Input variable defined later.
        }
    ],
    "inputs": [
        {
            "type": "promptString",
            "id": "FRONTEND_PORT",
            "description": "Enter your frontend host port",
            "default": "55512"
        },
        {
            "type": "promptString",
            "id": "KARMA_PORT",
            "description": "Enter your frontend Karma's tests report host port",
            "default": "55513"
        },
    ]
}